# lighthouse-4844

A docker-compose setup for running lighthouse with different execution clients on different 4844 testnets.

## How to use

Clone the repository along with submodules for latest testnets:
```
git clone --recurse-submodules https://github.com/ethDreamer/lighthouse-4844.git
```

Ensure you have the latest copy of 4844-testnet:
```
cd lighthouse-4844 && git submodule update --remote
```

#### Set Variables in `globals.sh`

The default variables that must be set correctly before starting the containers are:

- `ETH_TESTNET`    # the name of the testnet directory to use (see directories in `./shared/4844-testnet/network-configs`)
- `EXECUTION_NODE` # pick between geth, nethermind, or ~~besu~~
- `CONSENSUS_DISC` # the discovery port (TCP/UDP) for lighthouse (should be accessible from internet)
- `EXECUTION_DISC` # the discovery port (TCP/UDP) for execution node (should be accessible from internet)

After editing these be sure to run:
```
source ./globals.sh
```

Also ensure you generate the jwt token:
```
./gen-jwt.sh
```

#### Start the nodes

To enable only the necessary services (consensus/execution nodes), simply run:
```
docker compose -f beacon.yml -f execution.yml up -d
```

The yaml files are split up so that services can be swapped in as needed. There are two optional additional services:

- `metrics.yml`   # Enables prometheus metrics collection & grafana server
- `proxy.yml`     # A proxy between the beacon and execution node for debugging

These can be enabled by just adding them into the `docker compose` command. So the proxy service can be enabled with:
```
docker compose -f beacon.yml -f execution.yml -f proxy.yml up -d
```

#### Advanced Configuration

There are additional environment variables in `globals.sh` which can be set if needed. By default, the processes will be run with the same credentials as the user that sources `globals.sh`. These credentials can be changed by setting the following variables in `globals.sh`:

- `BEACON_UID`
- `BEACON_GID`
- `EXECUTION_UID`
- `EXECUTION_GID`
- `METRICS_UID`
- `METRICS_GID`

The names of the images & containers generated by `docker-compose` can also be changed using the variables:

- `IMAGE_PREFIX`
- `CONTAINER_PREFIX`

This is useful when running multiple instances of this compose setup on the same machine. There is also a `remove-images.sh` script included for convenience to delete the images generated by this compose setup.

